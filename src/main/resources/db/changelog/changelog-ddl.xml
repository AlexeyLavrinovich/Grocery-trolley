<?xml version="1.0" encoding="UTF-8" ?>
<databaseChangeLog xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
                   xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
                   xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.0.xsd">

    <changeSet id="1" author="Alexey Lavrinovich">
        <sql>
            create table customer (
                id bigint generated by default as identity,
                name varchar(255),
                tier integer,
                primary key (id)
            );

            create table order_product (
                order_id bigint not null,
                product_id bigint not null,
                primary key (order_id, product_id)
            );

            create table product (
                id bigint generated by default as identity,
                category varchar(255),
                name varchar(255),
                price double,
                primary key (id)
            );

            create table product_order (
                id bigint generated by default as identity,
                order_date date,
                delivery_date date,
                status varchar(255),
                customer_id bigint,
                primary key (id)
            );

            alter table order_product
                add constraint product_to_order_product_fk
                foreign key (product_id) references product;

            alter table order_product
                add constraint order_to_order_product_fk
                foreign key (order_id) references product_order;

            alter table product_order
                add constraint customer_fk
                foreign key (customer_id) references customer;
        </sql>
    </changeSet>

</databaseChangeLog>